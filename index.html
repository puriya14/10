<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b1022" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="HON Predictor" />
  <base href="./" />
  <link rel="manifest" href="manifest.webmanifest" />
  <title>HON Predictor — v1.5.0</title>
  <style>
    :root{
      --bg:#0b1022; --fg:#eaf2ff; --muted:#9db4d1; --card:#111735;
      --accent:#5cc8ff; --ok:#39d98a; --warn:#ffcf5c; --bad:#ff7b7b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(180deg,var(--bg),#040814);
      color:var(--fg); font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;
      display:flex; justify-content:center; padding:16px;
    }
    .app{width:min(880px,100%); display:flex; flex-direction:column; gap:12px}
    .card{
      background:linear-gradient(180deg, #0f1637, #0b1130);
      border:1px solid #1d2858; border-radius:16px; padding:14px;
    }
    h1{margin:0 0 6px; font-size:1.15rem}
    .muted{color:var(--muted)}
    .controls{display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:8px}
    input[type="text"]{
      flex:1; min-width:220px; background:#0d1432; color:var(--fg);
      border:1px solid #1d2858; border-radius:12px; padding:10px 12px; outline:none;
    }
    button{
      all:unset; background:color-mix(in oklab, var(--accent) 20%, black);
      border:1px solid #2c355f; padding:10px 14px; border-radius:12px; cursor:pointer;
    }
    button.ghost{background:transparent}
    .badge{font-size:.78rem; padding:.2rem .5rem; border:1px solid #2c355f; border-radius:999px; color:#9db4d1}
    .nums{display:flex; flex-wrap:wrap; gap:6px; margin-top:6px}
    .chip{
      padding:.35rem .55rem; border-radius:10px; border:1px solid #2c355f;
      font-variant-numeric:tabular-nums; display:inline-flex; align-items:center; gap:6px;
      background:#0e1534;
    }
    .chip .icon{opacity:.95}
    .titlerow{display:flex; align-items:center; justify-content:space-between; gap:8px}
    .small{font-size:.92rem}
    .note{font-size:.85rem; color:#9db4d1}
    .hr{height:1px; background:#1d2858; margin:8px 0}

    /* Isı panosu (1–80) */
    .heatgrid{
      display:grid; grid-template-columns:repeat(10,1fr); gap:6px; margin-top:8px;
    }
    .cell{
      background:#0e1534; border:1px solid #222c5a; border-radius:10px; padding:8px;
      text-align:center; display:flex; align-items:center; justify-content:center; gap:6px;
      font-variant-numeric:tabular-nums;
    }
    .cell .n{font-weight:700}
    .hot{border-color:#ff8f5c}
    .cold{border-color:#6fb7ff}

    /* Çark alanı */
    .wheelbox{display:grid; grid-template-columns:200px 1fr; gap:14px; align-items:center}
    @media (max-width:700px){ .wheelbox{grid-template-columns:1fr} }
    canvas#wheel{
      width:200px; height:200px; background:#0e1534; border:1px solid #222c5a; border-radius:50%;
      box-shadow:0 10px 30px rgba(0,0,0,.25) inset;
    }
    .pointer{
      width:0; height:0; border-left:10px solid transparent; border-right:10px solid transparent;
      border-bottom:16px solid #ffd479; margin:auto; transform:translateY(-6px);
      filter:drop-shadow(0 2px 4px rgba(0,0,0,.5));
    }
    .winflash{animation:flash 900ms ease-in-out 1}
    @keyframes flash{ 0%{background:#0e1534} 40%{background:#18306e} 70%{background:#0e1534} 100%{background:#0e1534} }
  </style>
</head>
<body>
  <div class="app">
    <!-- ÜST: Veri giriş + sayım -->
    <section class="card">
      <div class="titlerow">
        <h1>HON Predictor — v1.5.0</h1>
        <span class="badge" id="countBadge">çekiliş: 0</span>
      </div>
      <div class="muted small">Sade mod: veriyi al → arkaplanda analiz → sadece tahmin, kupon, ısı panosu ve AI çarkı göster.</div>
      <div class="controls">
        <input id="quickLine" type="text" placeholder="Son 20 sayı: 3 7 12 18 ..." />
        <button id="btnQuickAdd">Ekle</button>
        <button id="btnLoadUserData" class="ghost">Benim 04.09.2025 verimi ekle</button>
        <button id="btnClear" class="ghost">Temizle</button>
      </div>
    </section>

    <!-- TAHMİN + KUPONLAR -->
    <section class="card">
      <div class="titlerow">
        <h2 style="margin:0">Tahmin 20’li</h2>
        <div class="note">🔥 sıcak • ❄️ soğuk (ansambl + trend + wfreq + gap)</div>
      </div>
      <div id="pred20" class="nums"></div>
      <div class="hr"></div>
      <div class="titlerow"><div><b>2’li • 5 kupon</b></div><button id="copy2" class="ghost small">Kopyala</button></div>
      <div id="t2" class="nums"></div>
      <div class="titlerow"><div><b>3’lü • 5 kupon</b></div><button id="copy3" class="ghost small">Kopyala</button></div>
      <div id="t3" class="nums"></div>
      <div class="titlerow"><div><b>4’lü • 5 kupon</b></div><button id="copy4" class="ghost small">Kopyala</button></div>
      <div id="t4" class="nums"></div>
      <div class="hr"></div>
      <div class="controls">
        <button id="btnReroll">Tekrar üret (çeşitlilik)</button>
        <span class="note">Seed değişir; kuponlar ve tahmin listesi küçük farklılıklarla çeşitlenir.</span>
      </div>
    </section>

    <!-- AI ŞANS ÇARKI -->
    <section class="card">
      <div class="titlerow">
        <h2 style="margin:0">AI Şans Çarkı</h2>
        <div class="note">Top-20 dilimlenir; her dilimin olasılığı AI skorlarına göre ağırlıklıdır.</div>
      </div>
      <div class="pointer"></div>
      <div class="wheelbox">
        <canvas id="wheel" width="360" height="360"></canvas>
        <div>
          <div class="nums" id="wheelLegend"></div>
          <div class="controls" style="margin-top:10px">
            <button id="btnSpin">Çevir</button>
            <button id="btnSpinSoft" class="ghost">Yumuşak çevir</button>
            <span class="note" id="spinResult">—</span>
          </div>
        </div>
      </div>
    </section>

    <!-- ISI PANOSU 1–80 -->
    <section class="card">
      <div class="titlerow">
        <h2 style="margin:0">Isı Panosu — 1…80</h2>
        <div class="note">Tüm sayılar: 🔥 en sıcak ~üst %20, ❄️ en soğuk ~alt %20, • nötr</div>
      </div>
      <div id="heat80" class="heatgrid"></div>
    </section>

    <!-- ALT NOT -->
    <section class="card">
      <div class="small muted">
        Not: Bu uygulama istatistiksel sezgiseller ve anomali tespiti kullanır. **Kazanç garantisi vermez.**
        Amacımız daha bilinçli deneme ve bütçe disiplinidir.
      </div>
    </section>
  </div>

  <script>
    const APP_VERSION='1.5.0';
    const el = id => document.getElementById(id);
    const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
    const sum = a=>a.reduce((x,y)=>x+y,0);

    // ----------------- Depo -----------------
    const storeKey='hon-data-v5';
    const state = JSON.parse(localStorage.getItem(storeKey) || '{"draws":[]}');
    const save=()=>localStorage.setItem(storeKey, JSON.stringify(state));
    const refreshCount=()=> el('countBadge').textContent='çekiliş: '+state.draws.length;

    function parseLineToDraw(line){
      const nums=(line.match(/\d+/g)||[]).map(x=>parseInt(x,10)).filter(n=>n>=1&&n<=80);
      if(nums.length<20) return null;
      const arr=nums.slice(0,20).sort((a,b)=>a-b);
      return { id:crypto.randomUUID(), t:Date.now(), nums:arr };
    }
    function addDraw(arr){
      const sig=arr.join(',');
      const seen=new Set(state.draws.map(d=>d.nums.join(',')));
      if(seen.has(sig)) return false;
      state.draws.push({id:crypto.randomUUID(), t:Date.now(), nums:arr});
      save(); return true;
    }

    // ------------- Kullanıcı verisi (gönderdiğin blok) -------------
    // Tam metin aşağıdaki FULL_USER_DATA sabitinde (uzun).
  </script>

  <script>
/* === FULL_USER_DATA (tam) === */
const FULL_USER_DATA = `
Çekiliş no:18663 — 04.09.2025 — 07:02

9, 12, 16, 17, 20, 26, 28, 34
36, 37, 41, 42, 43, 46, 47, 48
52, 56, 58, 59

Çekiliş no:18664 — 04.09.2025 — 07:07

11, 12, 18, 19, 28, 29, 30, 33
34, 37, 39, 47, 49, 50, 60, 62
64, 67, 76, 78

Çekiliş no:18665 — 04.09.2025 — 07:12

2, 3, 9, 15, 20, 27, 34, 35
39, 53, 55, 61, 64, 65, 69
71, 73, 75, 77

Çekiliş no:18666 — 04.09.2025 — 07:17

2, 4, 7, 9, 15, 19, 23, 30
32, 34, 40, 46, 50, 53, 60
61, 65, 69, 71

Çekiliş no:18667 — 04.09.2025 — 07:22

14, 15, 22, 28, 31, 33, 43
44, 47, 49, 55, 56, 57, 63, 64
65, 66, 67, 68

Çekiliş no:18668 — 04.09.2025 — 07:27

5, 7, 12, 15, 17, 23, 39, 43
48, 52, 53, 54, 61, 65, 70
72, 74, 76, 78

Çekiliş no:18669 — 04.09.2025 — 07:32

1, 4, 23, 25, 27, 44, 46, 48
50, 54, 59, 61, 62, 63, 64, 65
66, 72, 73, 75

Çekiliş no:18670 — 04.09.2025 — 07:37

1, 2, 4, 7, 10, 24, 27, 34
37, 46, 47, 48, 49, 51, 53, 54
56, 57, 75, 77

Çekiliş no:18671 — 04.09.2025 — 07:42

2, 3, 5, 11, 12, 14, 22
30, 31, 37, 42, 49, 55, 56, 57
66, 69, 75, 79

Çekiliş no:18672 — 04.09.2025 — 07:47

5, 7, 9, 15, 21, 27, 28, 37
39, 40, 43, 45, 49, 53, 56, 65
73, 74, 77, 78

Çekiliş no:18673 — 04.09.2025 — 07:52

8, 9, 13, 17, 19, 21, 23, 27
30, 36, 37, 40, 41, 44, 48, 50
60, 67, 69, 75

Çekiliş no:18674 — 04.09.2025 — 07:57

10, 11, 13, 16, 18, 21, 22, 25
29, 33, 36, 39, 40, 48, 49, 52
56, 63, 74, 79

Çekiliş no:18675 — 04.09.2025 — 08:02

6, 10, 13, 17, 21, 22, 29, 34
40, 42, 43, 48, 54, 57, 59, 61
62, 66, 72, 75

Çekiliş no:18676 — 04.09.2025 — 08:07

12, 13, 17, 23, 24, 28, 29, 30
32, 34, 39, 43, 48, 52, 53, 55
57, 61, 71, 78

Çekiliş no:18677 — 04.09.2025 — 08:12

1, 8, 12, 15, 16, 17, 25, 37
39, 46, 47, 54, 56, 64, 66, 71
76, 77, 78, 79

Çekiliş no:18678 — 04.09.2025 — 08:17

12, 13, 24, 25, 29, 31, 32
34, 38, 41, 43, 44, 46, 51, 53
55, 57, 70, 78

Çekiliş no:18679 — 04.09.2025 — 08:22

1, 14, 16, 21, 24, 25, 32, 33
35, 38, 40, 43, 45, 47, 50, 55
58, 60, 61, 72

Çekiliş no:18680 — 04.09.2025 — 08:27

2, 6, 7, 15, 19, 20, 31, 33
40, 41, 45, 49, 52, 53, 54, 59
65, 66, 68, 69

Çekiliş no:18681 — 04.09.2025 — 08:32

1, 2, 14, 15, 16, 27, 29, 37
38, 39, 46, 49, 55, 56, 57, 63
64, 68, 76, 79

Çekiliş no:18682 — 04.09.2025 — 08:37

2, 8, 9, 12, 17, 24, 26, 27
32, 34, 36, 39, 40, 43, 51, 55
58, 60, 69, 80

Çekiliş no:18683 — 04.09.2025 — 08:42

2, 11, 14, 17, 25, 40, 41, 43
45, 51, 55, 61, 63, 64, 65, 66
73, 77, 78, 80

Çekiliş no:18684 — 04.09.2025 — 08:47

3, 4, 8, 11, 14, 15, 18, 20
22, 23, 26, 30, 32, 39, 40, 41
60, 61, 68, 77

Çekiliş no:18685 — 04.09.2025 — 08:52

4, 8, 10, 12, 15, 18, 21, 32
38, 44, 51, 52, 54, 62, 66, 68
73, 74, 76, 80

Çekiliş no:18686 — 04.09.2025 — 08:57

5, 10, 11, 15, 16, 18, 21, 28
41, 44, 47, 50, 56, 65, 66, 68
72, 73, 76, 78

Çekiliş no:18687 — 04.09.2025 — 09:02

7, 9, 12, 13, 14, 28, 31, 39, 41
42, 43, 44, 46, 48, 49, 51, 57
64, 66, 67, 69

Çekiliş no:18688 — 04.09.2025 — 09:07

1, 2, 7, 13, 19, 24, 28, 32
42, 44, 45, 55, 57, 59, 65
74, 75, 78, 79

Çekiliş no:18689 — 04.09.2025 — 09:12

3, 6, 9, 12, 19, 25, 29, 37
39, 42, 44, 57, 58, 60, 70
71, 74, 75, 78

Çekiliş no:18690 — 04.09.2025 — 09:17

1, 7, 11, 22, 26, 28, 33, 34
36, 41, 47, 48, 51, 54, 62
66, 67, 74, 75

Çekiliş no:18691 — 04.09.2025 — 09:22

4, 5, 6, 14, 21, 26, 28, 29
34, 44, 45, 47, 48, 52, 54
65, 66, 78, 79

Çekiliş no:18692 — 04.09.2025 — 09:27

1, 2, 4, 9, 10, 11, 13, 20
26, 28, 29, 30, 36, 39, 41, 59
65, 72, 73, 77

Çekiliş no:18693 — 04.09.2025 — 09:32

1, 4, 5, 6, 12, 15, 16, 19
27, 29, 39, 42, 43, 45, 46
52, 53, 62, 69

Çekiliş no:18694 — 04.09.2025 — 09:37

3, 10, 14, 20, 22, 23, 30, 36
39, 40, 44, 45, 47, 61, 62, 68
73, 74, 78, 80

Çekiliş no:18695 — 04.09.2025 — 09:42

2, 4, 5, 7, 11, 12, 13, 38
46, 49, 51, 52, 53, 55, 57, 63
64, 66, 69, 76

Çekiliş no:18696 — 04.09.2025 — 09:47

2, 11, 15, 23, 25, 28, 31, 34
36, 38, 40, 50, 60, 64
66, 73, 76, 79

Çekiliş no:18697 — 04.09.2025 — 09:52

9, 21, 23, 25, 30, 31, 32
37, 42, 44, 52, 57, 60, 64, 68
75, 76, 77, 79

Çekiliş no:18698 — 04.09.2025 — 09:57

1, 2, 4, 5, 8, 15, 20, 27
28, 39, 43, 44, 45, 47, 50
53, 56, 77, 79

Çekiliş no:18699 — 04.09.2025 — 10:02

11, 14, 20, 21, 26, 28, 36, 37
41, 53, 54, 55, 56, 58, 60, 63
64, 69, 71, 72

Çekiliş no:18700 — 04.09.2025 — 10:07

2, 3, 5, 13, 15, 17, 20, 27
32, 38, 39, 41, 42, 51, 57, 61
62, 63, 78, 80

Çekiliş no:18701 — 04.09.2025 — 10:12

6, 8, 17, 20, 23, 25, 28
31, 41, 44, 46, 50, 56, 57, 61
63, 64, 72, 75

Çekiliş no:18702 — 04.09.2025 — 10:17

2, 3, 4, 10, 12, 13, 17, 18
27, 33, 37, 41, 42, 48, 56, 59
66, 70, 73, 77

Çekiliş no:18703 — 04.09.2025 — 10:22

2, 3, 9, 18, 21, 22, 25, 29
30, 41, 43, 53, 55, 56, 65, 66
69, 74, 75, 76

Çekiliş no:18704 — 04.09.2025 — 10:27

3, 7, 14, 16, 19, 24, 33, 41
49, 50, 59, 60, 61, 65, 67, 68
74, 75, 77, 79

Çekiliş no:18705 — 04.09.2025 — 10:32

4, 8, 9, 15, 18, 19, 23, 27
29, 34, 39, 43, 50, 52, 58, 62
63, 69, 71, 73

Çekiliş no:18706 — 04.09.2025 — 10:37

2, 14, 16, 19, 27, 34, 37, 46
44, 45, 50, 52, 55, 57, 60
64, 66, 72, 78

Çekiliş no:18707 — 04.09.2025 — 10:42

8, 9, 10, 12, 17, 19, 21, 23
32, 33, 43, 44, 53, 64, 66, 67
68, 69, 72, 80

Çekiliş no:18708 — 04.09.2025 — 10:47

1, 5, 6, 9, 13, 14, 17, 24
27, 33, 35, 38, 45, 50, 57, 64
68, 70, 73, 79

Çekiliş no:18709 — 04.09.2025 — 10:52

1, 8, 12, 13, 14, 23, 24, 30
41, 42, 44, 47, 50, 52, 57, 58
66, 70, 71, 74

Çekiliş no:18710 — 04.09.2025 — 10:57

3, 5, 6, 7, 11, 16, 20, 22
35, 45, 46, 53, 57, 59, 60, 63
70, 72, 78, 79

Çekiliş no:18711 — 04.09.2025 — 11:02

2, 5, 7, 15, 23, 34, 35
37, 41, 43, 53, 57, 60, 66
67, 74, 76, 77

Çekiliş no:18712 — 04.09.2025 — 11:07

7, 15, 19, 22, 23, 28, 32, 37
41, 43, 49, 52, 58, 59
62, 69, 70

Çekiliş no:18713 — 04.09.2025 — 11:12

1, 11, 13, 14, 15, 20
27, 30, 39, 40, 50, 62, 63
67, 72, 80

Çekiliş no:18714 — 04.09.2025 — 11:17

6, 12, 20, 23, 26, 30, 31, 32
36, 39, 51, 55, 58, 63, 71
73, 75, 79

Çekiliş no:18715 — 04.09.2025 — 11:22

1, 3, 9, 21, 29, 31, 34, 37, 39
40, 42, 48, 50, 52, 54, 56, 71
74, 77, 80

Çekiliş no:18716 — 04.09.2025 — 11:27

3, 7, 14, 17, 19, 23, 25
35, 37, 38, 50, 56, 58, 59, 64
66, 67, 70

Çekiliş no:18717 — 04.09.2025 — 11:32

2, 4, 6, 7, 12, 13, 15, 16
21, 25, 36, 54, 56, 58, 61
64, 67, 70, 74

Çekiliş no:18718 — 04.09.2025 — 11:37

4, 10, 16, 18, 20, 25, 28, 33
35, 39, 40, 41, 44, 55, 59
71, 72, 73, 75

Çekiliş no:18719 — 04.09.2025 — 11:42

2, 6, 12, 13, 15, 36, 38
41, 46, 50, 51, 54, 55, 59
64, 66, 70, 74

Çekiliş no:18720 — 04.09.2025 — 11:47

4, 5, 7, 12, 13, 18, 19, 20
33, 35, 43, 45, 53, 54, 56
62, 70, 80

Çekiliş no:18721 — 04.09.2025 — 11:52

1, 2, 5, 6, 10, 13, 16, 17
45, 46, 49, 51, 54, 57, 59
61, 72, 74, 75

Çekiliş no:18722 — 04.09.2025 — 11:57

31, 34, 35, 45, 46, 49, 53, 62
64, 69, 72, 77

Çekiliş no:18723 — 04.09.2025 — 12:02

11, 13, 23, 24, 28, 41, 45, 47
48, 52, 55, 56, 57, 59, 61, 62
67, 73, 74, 77

Çekiliş no:18724 — 04.09.2025 — 12:07

14, 20, 29, 30, 33, 35, 37
39, 45, 46, 48, 53, 54, 56, 58
66, 67, 68, 76

Çekiliş no:18725 — 04.09.2025 — 12:12

11, 19, 22, 26, 34, 37, 38
41, 52, 55, 57, 58, 59, 62, 65
71, 72, 75, 80

Çekiliş no:18726 — 04.09.2025 — 12:17

3, 20, 22, 24, 25, 27, 32, 37
43, 44, 46, 48, 56, 57, 58
61, 63, 68, 70

Çekiliş no:18727 — 04.09.2025 — 12:22

2, 5, 6, 7, 9, 20, 25, 26
31, 32, 41, 42, 45, 52, 56, 60
69, 73, 75, 80

Çekiliş no:18728 — 04.09.2025 — 12:27

1, 6, 23, 26, 27, 31, 33, 47
50, 51, 58, 64, 65, 66, 70, 73
74, 75, 79, 80

Çekiliş no:18729 — 04.09.2025 — 12:32

1, 13, 22, 24, 26, 30, 31
43, 47, 48, 50, 59, 61, 63, 64
66, 68, 79, 80

Çekiliş no:18730 — 04.09.2025 — 12:37

7, 9, 14, 24, 30, 34, 38, 41
47, 51, 52, 55, 57, 58, 61, 69
70, 71, 72, 73

Çekiliş no:18731 — 04.09.2025 — 12:42

1, 6, 9, 14, 19, 23, 31, 36
37, 42, 47, 52, 55, 56, 59, 63
74, 77, 78, 79

Çekiliş no:18732 — 04.09.2025 — 12:47

13, 16, 21, 27, 28, 29, 35
44, 47, 49, 50, 60, 63, 66
67, 75, 77, 79

Çekiliş no:18733 — 04.09.2025 — 12:52

1, 3, 9, 12, 13, 15, 23, 26
29, 41, 43, 46, 48, 51, 52, 68
69, 72, 74, 77

Çekiliş no:18734 — 04.09.2025 — 12:57

35, 37, 40, 43, 44, 49, 55, 59
64, 70, 74, 78

Çekiliş no:18723 — 04.09.2025 — 12:02

11, 13, 23, 24, 28, 41, 45, 47
48, 52, 55, 56, 57, 59, 61, 62
67, 73, 74, 77

Çekiliş no:18724 — 04.09.2025 — 12:07

14, 20, 29, 30, 33, 35, 37
39, 45, 46, 48, 53, 54, 56, 58
66, 67, 68, 76

Çekiliş no:18725 — 04.09.2025 — 12:12

11, 19, 22, 26, 34, 37, 38
41, 52, 55, 57, 58, 59, 62, 65
71, 72, 75, 80

Çekiliş no:18726 — 04.09.2025 — 12:17

3, 20, 22, 24, 25, 27, 32, 37
43, 44, 46, 48, 56, 57, 58
61, 63, 68, 70

Çekiliş no:18727 — 04.09.2025 — 12:22

2, 5, 6, 7, 9, 20, 25, 26
31, 32, 41, 42, 45, 52, 56, 60
69, 73, 75, 80

Çekiliş no:18728 — 04.09.2025 — 12:27

1, 6, 23, 26, 27, 31, 33, 47
50, 51, 58, 64, 65, 66, 70, 73
74, 75, 79, 80

Çekiliş no:18729 — 04.09.2025 — 12:32

1, 13, 22, 24, 26, 30, 31
43, 47, 48, 50, 59, 61, 63, 64
66, 68, 79, 80

Çekiliş no:18730 — 04.09.2025 — 12:37

7, 9, 14, 24, 30, 34, 38, 41
47, 51, 52, 55, 57, 58, 61, 69
70, 71, 72, 73

Çekiliş no:18731 — 04.09.2025 — 12:42

1, 6, 9, 14, 19, 23, 31, 36
37, 42, 47, 52, 55, 56, 59, 63
74, 77, 78, 79

Çekiliş no:18732 — 04.09.2025 — 12:47

13, 16, 21, 27, 28, 29, 35
44, 47, 49, 50, 60, 63, 66
67, 75, 77, 79

Çekiliş no:18733 — 04.09.2025 — 12:52

1, 3, 9, 12, 13, 15, 23, 26
29, 41, 43, 46, 48, 51, 52, 68
69, 72, 74, 77

Çekiliş no:18734 — 04.09.2025 — 12:57

35, 37, 40, 43, 44, 49, 55, 59
64, 70, 74, 78

Çekiliş no:18747 — 04.09.2025 — 14:02

1, 13, 14, 17, 19, 25, 37
39, 41, 44, 49, 53, 65
70, 74, 76, 80

Çekiliş no:18748 — 04.09.2025 — 14:07

4, 11, 15, 19, 21, 22
31, 38, 44, 51, 54, 60, 63
64, 75, 76, 79

Çekiliş no:18749 — 04.09.2025 — 14:12

2, 3, 9, 13, 18, 20, 22, 25
26, 27, 29, 31, 32, 38, 39, 47
64, 68, 74, 75

Çekiliş no:18750 — 04.09.2025 — 14:17

1, 5, 6, 10, 16, 22, 24, 29
32, 36, 43, 46, 53, 56, 58
68, 71, 73

Çekiliş no:18751 — 04.09.2025 — 14:22

10, 21, 22, 23, 27, 28, 29, 31
39, 44, 50, 54, 63, 66
68, 77, 78, 79

Çekiliş no:18752 — 04.09.2025 — 14:27

2, 8, 6, 10, 19, 30, 31, 32
37, 38, 48, 52, 62, 69, 71
72, 73, 77, 80

Çekiliş no:18753 — 04.09.2025 — 14:32

3, 5, 7, 8, 13, 17, 18, 21, 23
35, 41, 44, 45, 46, 57, 58
72, 77, 74

Çekiliş no:18754 — 04.09.2025 — 14:37

4, 6, 8, 10, 13, 17, 23, 28
31, 33, 41, 45, 55, 64, 70, 71
72, 74, 75, 77

Çekiliş no:18755 — 04.09.2025 — 14:42

6, 21, 22, 31, 34, 40, 42, 44
45, 47, 50, 51, 53, 55, 57, 58
64, 77, 80

Çekiliş no:18756 — 04.09.2025 — 14:47

1, 5, 7, 21, 23, 25
36, 37, 42, 48, 50, 53, 54
65, 70, 77, 79

Çekiliş no:18757 — 04.09.2025 — 14:52

12, 13, 23, 25, 34, 36, 43, 46
52, 54, 59, 61, 62
63, 72, 74, 76

Çekiliş no:18758 — 04.09.2025 — 14:57

36, 49, 51, 57, 58, 60, 65, 67
69, 71, 74, 77

Çekiliş no:18759 — 04.09.2025 — 15:02

4, 10, 12, 15, 19, 24, 26, 29
36, 46, 47, 48, 50, 51, 53
63, 64, 72, 77

Çekiliş no:18760 — 04.09.2025 — 15:07

2, 5, 8, 13, 25, 43, 47
51, 53, 58, 59, 64, 65, 67, 68
69, 72, 73, 77

Çekiliş no:18761 — 04.09.2025 — 15:12

2, 7, 15, 18, 20, 21, 26
30, 32, 34, 42, 45, 50, 51, 55
57, 59, 68, 72

Çekiliş no:18762 — 04.09.2025 — 15:17

1, 3, 7, 15, 17, 20, 25, 28
32, 41, 42, 45, 50, 51, 53, 64
66, 70, 77, 78

Çekiliş no:18763 — 04.09.2025 — 15:22

1, 3, 4, 10, 17, 22, 23, 24
28, 31, 32, 34, 36, 50, 53
57, 59, 62, 64

Çekiliş no:18764 — 04.09.2025 — 15:27

4, 8, 10, 17, 20, 25, 28, 35
36, 47, 49, 51, 52, 64, 65, 67
72, 74, 75, 77

Çekiliş no:18765 — 04.09.2025 — 15:32

2, 6, 8, 10, 11, 12, 24, 25
28, 39, 49, 53, 55, 63, 66, 68
70, 71, 75, 76

Çekiliş no:18766 — 04.09.2025 — 15:37

2, 12, 15, 18, 19, 20, 25
29, 33, 35, 40, 43, 48, 58
61, 64, 66, 69

Çekiliş no:18767 — 04.09.2025 — 15:42

2, 5, 6, 7, 9, 12, 13
22, 26, 29, 30, 37, 42, 53, 54
56, 62, 71, 79

Çekiliş no:18768 — 04.09.2025 — 15:47

3, 18, 20, 22, 28, 31, 32
42, 44, 47, 49, 51, 58, 60, 61, 62
63, 71, 75, 77

Çekiliş no:18769 — 04.09.2025 — 15:52

32, 36, 39, 40, 45, 47, 48, 51
52, 60, 62, 70, 76

Çekiliş no:18771 — 04.09.2025 — 16:02

6, 7, 8, 20, 23, 25, 27, 29
30, 32, 37, 48, 51, 55, 59, 62
64, 67, 69, 73

Çekiliş no:18772 — 04.09.2025 — 16:07

2, 9, 16, 21, 24, 26, 30, 42
53, 55, 60, 64, 65, 69, 70, 71
74, 78, 79, 80

Çekiliş no:18773 — 04.09.2025 — 16:12

14, 19, 21, 24, 25, 33, 34, 39
41, 45, 46, 48, 50, 54, 57, 60
65, 69, 73, 77

Çekiliş no:18774 — 04.09.2025 — 16:17

5, 6, 7, 8, 19, 21, 24, 25
28, 30, 31, 32, 39, 45, 48, 49
57, 59, 62, 73

Çekiliş no:18775 — 04.09.2025 — 16:22

1, 7, 17, 21, 25, 26, 28, 30
32, 33, 41, 44, 45, 50, 53, 57
63, 71, 72, 77

Çekiliş no:18776 — 04.09.2025 — 16:27

8, 9, 15, 19, 24, 26, 27, 31
32, 34, 37, 52, 54, 57, 59, 63
66, 68, 72, 79

Çekiliş no:18777 — 04.09.2025 — 16:32

1, 3, 4, 18, 21, 22, 23, 24
32, 34, 37, 38, 44, 49, 51, 53
56, 66, 72, 77

Çekiliş no:18778 — 04.09.2025 — 16:37

2, 3, 7, 21, 23, 26, 27, 28
30, 36, 37, 45, 47, 48, 51, 61
62, 63, 72, 75

Çekiliş no:18779 — 04.09.2025 — 16:42

1, 8, 11, 12, 14, 17, 19, 21
29, 32, 37, 46, 50, 57, 60, 61
63, 67, 70, 77

Çekiliş no:18780 — 04.09.2025 — 16:47

3, 6, 8, 22, 23, 26, 27, 29
31, 33, 43, 45, 46, 51, 53, 54
55, 56, 61, 64

Çekiliş no:18781 — 04.09.2025 — 16:52

1, 15, 18, 24, 25, 27, 29, 38
44, 45, 46, 52, 54, 60, 62, 64
66, 71, 72, 78

Çekiliş no:18782 — 04.09.2025 — 16:57

37, 38, 41, 43, 53, 57, 59, 61
63, 69, 70, 72

Çekiliş no:18783 — 04.09.2025 — 17:02

4, 6, 8, 16, 21, 23, 24, 41
42, 43, 46, 53, 55, 59, 60, 64
65, 66, 78, 79

Çekiliş no:18784 — 04.09.2025 — 17:07

1, 5, 7, 10, 11, 12, 17, 22
33, 35, 36, 37, 40, 46, 48, 49
54, 62, 68, 80

Çekiliş no:18785 — 04.09.2025 — 17:12

4, 5, 7, 11, 13, 14, 15, 19
29, 32, 34, 42, 47, 50, 54, 59
60, 71, 74, 79

Çekiliş no:18786 — 04.09.2025 — 17:17

1, 8, 9, 26, 30, 31, 32, 37
38, 49, 53, 54, 56, 58, 65, 66
71, 75, 79, 80

Çekiliş no:18787 — 04.09.2025 — 17:22

1, 5, 7, 9, 14, 22, 31, 33
34, 37, 42, 44, 50, 58, 62, 65
71, 72, 73, 79

Çekiliş no:18788 — 04.09.2025 — 17:27

1, 3, 6, 7, 10, 17, 28, 33
41, 44, 49, 54, 58, 59, 60, 67
73, 75, 76, 77

Çekiliş no:18789 — 04.09.2025 — 17:32

22, 23, 24, 26, 35, 37, 39, 42
43, 44, 50, 52, 54, 60, 63, 64
69, 71, 77, 78

Çekiliş no:18790 — 04.09.2025 — 17:37

3, 6, 7, 9, 12, 16, 30, 33
35, 37, 40, 41, 47, 48, 54, 56
63, 65, 78, 80

Çekiliş no:18791 — 04.09.2025 — 17:42

4, 6, 9, 12, 17, 27, 34, 35
41, 42, 48, 51, 53, 58, 64, 69
70, 71, 74, 75

Çekiliş no:18792 — 04.09.2025 — 17:47

4, 7, 11, 13, 24, 26, 31, 35
38, 41, 46, 54, 55, 56, 60, 65
67, 73, 76, 79

Çekiliş no:18793 — 04.09.2025 — 17:52

8, 9, 14, 15, 16, 18, 27, 32
33, 37, 40, 44, 47, 48, 50, 56
58, 60, 61, 63

Çekiliş no:18794 — 04.09.2025 — 17:57

2, 4, 16, 27, 30, 32, 36, 40
41, 42, 43, 47, 56, 60, 63, 64
65, 68, 77, 80

Çekiliş no:18795 — 04.09.2025 — 18:02

5, 12, 21, 25, 29, 43, 44, 48
50, 53, 54, 57, 59, 62, 63, 64
66, 67, 74, 75

Çekiliş no:18796 — 04.09.2025 — 18:07

2, 3, 10, 11, 31, 34, 38, 39
46, 47, 51, 54, 57, 58, 59, 60
71, 75, 78, 79

Çekiliş no:18797 — 04.09.2025 — 18:12

1, 8, 10, 21, 32, 36, 39, 40
41, 43, 44, 45, 48, 54, 61, 64
65, 75, 78, 79

Çekiliş no:18798 — 04.09.2025 — 18:17

4, 5, 15, 18, 20, 25, 32, 38
45, 49, 59, 61, 65, 67, 69, 70
73, 75, 78, 79

Çekiliş no:18799 — 04.09.2025 — 18:22

1, 6, 8, 14, 20, 21, 30, 35
40, 46, 47, 51, 54, 56, 59, 60
63, 70, 77, 78

Çekiliş no:18800 — 04.09.2025 — 18:27

3, 4, 7, 11, 14, 16, 20, 29
36, 37, 43, 50, 51, 52, 55, 64
66, 67, 74, 76

Çekiliş no:18801 — 04.09.2025 — 18:32

3, 4, 6, 10, 14, 26, 31, 33
37, 43, 48, 54, 56, 61, 62, 64
67, 69, 72, 73

Çekiliş no:18802 — 04.09.2025 — 18:37

3, 6, 7, 11, 17, 20, 23, 30
45, 46, 47, 56, 58, 64, 68, 69
76, 77, 79, 80

Çekiliş no:18803 — 04.09.2025 — 18:42

6, 26, 27, 32, 34, 36, 40, 43
45, 46, 48, 52, 54, 57, 62, 66
68, 75, 76, 80

Çekiliş no:18804 — 04.09.2025 — 18:47

3, 9, 10, 13, 16, 22, 24, 25
28, 34, 40, 46, 51, 52, 53, 55
57, 59, 65, 66

Çekiliş no:18805 — 04.09.2025 — 18:52

4, 9, 11, 20, 21, 23, 24, 27
28, 31, 32, 34, 42, 51, 52, 61
65, 66, 70, 79

Çekiliş no:18806 — 04.09.2025 — 18:57

3, 4, 6, 10, 11, 17, 26, 31
34, 35, 41, 45, 46, 48, 54, 63
71, 73, 75, 78

Çekiliş no:18807 — 04.09.2025 — 19:02

4, 9, 24, 32, 36, 38, 44, 48
49, 53, 55, 56, 59, 63, 70, 72
73, 75, 76, 78

Çekiliş no:18808 — 04.09.2025 — 19:07

11, 14, 20, 23, 29, 39, 43, 44
46, 47, 52, 56, 57, 58, 61, 62
63, 67, 69, 74

Çekiliş no:18809 — 04.09.2025 — 19:12

1, 2, 15, 20, 28, 29, 39, 41
42, 43, 51, 52, 55, 59, 63, 65
69, 71, 72, 79

Çekiliş no:18810 — 04.09.2025 — 19:17

2, 3, 4, 7, 10, 12, 13, 15
16, 17, 25, 29, 36, 37, 48, 56
66, 71, 75, 76

Çekiliş no:18811 — 04.09.2025 — 19:22

3, 10, 15, 17, 25, 28, 29, 31
37, 38, 41, 50, 54, 55, 59, 69
75, 76, 78, 79
`;

function parseUserBlockToDraws(raw){
  const blocks = raw.split(/Çekiliş no:/i).map(s=>s.trim()).filter(Boolean);
  const out=[];
  for(const block of blocks){
    const nums=(block.match(/\b\d{1,2}\b/g)||[]).map(n=>parseInt(n,10)).filter(n=>n>=1&&n<=80);
    if(nums.length>=20) out.push(nums.slice(0,20).sort((a,b)=>a-b));
  }
  return out;
}
  </script>

  <script>
    // ----------------- İstatistik çekirdek -----------------
    function computeStats(){
      const draws=state.draws.slice();
      const n=draws.length;
      const counts=Array(81).fill(0);
      const lastSeen=Array(81).fill(Infinity);
      const wcounts=Array(81).fill(0);

      if(n===0) return {n, counts, wcounts, lastSeen};

      // yarı ömür: sabit (80) — sade mod
      const halfLife=80, lambda=Math.log(2)/halfLife;

      for(let i=0;i<n;i++){
        const age=(n-1)-i;
        const w=Math.exp(-lambda*age);
        const arr=draws[i].nums;
        for(const a of arr){
          counts[a]++; wcounts[a]+=w;
          if(lastSeen[a]===Infinity) lastSeen[a]=age;
        }
      }
      return {n, counts, wcounts, lastSeen};
    }

    // ---- BOCPD-lite (trend sinyali; arkaplanda) ----
    function lnGamma(z){ const g=7, C=[0.99999999999980993,676.5203681218851,-1259.1392167224028,771.32342877765313,-176.61502916214059,12.507343278686905,-0.13857109526572012,9.9843695780195716e-6,1.5056327351493116e-7]; if(z<0.5) return Math.log(Math.PI)-Math.log(Math.sin(Math.PI*z))-lnGamma(1-z); z-=1; let x=C[0]; for(let i=1;i<g+2;i++) x+=C[i]/(z+i); const t=z+g+0.5; return 0.5*Math.log(2*Math.PI)+(z+0.5)*Math.log(t)-t+Math.log(x); }
    const lnBeta=(a,b)=>lnGamma(a)+lnGamma(b)-lnGamma(a+b);
    const bbMarg=(s,n,a=1,b=1)=> lnBeta(a+s,b+n-s)-lnBeta(a,b);

    function bocpdTrendBoost(windowN=400, minSeg=40){
      const m=state.draws.length;
      if(m<minSeg*2) return Array(81).fill(0);
      const W=Math.min(windowN,m);
      const recent=state.draws.slice(-W);
      const presence=Array.from({length:81},()=>Array(W).fill(0));
      for(let i=0;i<W;i++){ const set=new Set(recent[i].nums); for(const v of set) presence[v][i]=1; }
      const boost=Array(81).fill(0);
      for(let v=1;v<=80;v++){
        const seq=presence[v], n=seq.length;
        const prefix=[0]; for(let i=0;i<n;i++) prefix.push(prefix[prefix.length-1]+seq[i]);
        const S=prefix[n], N=n, all=bbMarg(S,N,1,1);
        let best={z:-Infinity,t:-1,sL:0,nL:0,sR:0,nR:0};
        for(let t=minSeg; t<=n-minSeg; t++){
          const sL=prefix[t], nL=t, sR=S-sL, nR=N-nL;
          const z=(bbMarg(sL,nL,1,1)+bbMarg(sR,nR,1,1))-all;
          if(z>best.z) best={z,t,sL,nL,sR,nR};
        }
        const pL=(best.sL+1)/(best.nL+2), pR=(best.sR+1)/(best.nR+2);
        const delta=pR-pL;
        let b=0;
        if(best.z>2.5){ b += clamp(delta*6, -0.06, 0.08); }
        if(best.z>4.0){ b *= 1.5; }
        boost[v]=b;
      }
      return boost;
    }

    // ---- RNG & ansambl ----
    function mulberry32(a){ return function(){ var t=a+=0x6D2B79F5; t=Math.imul(t^t>>>15,t|1); t^=t+Math.imul(t^t>>>7,t|61); return ((t^t>>>14)>>>0)/4294967296; } }
    function seedFromNow(){ const d=new Date(); return (d.getFullYear()*10000 + (d.getMonth()+1)*100 + d.getDate())*100 + d.getHours(); }
    let ENGINE_SEED = seedFromNow();
    function rng(seedStr){
      if(!seedStr){ return mulberry32((ENGINE_SEED>>>0) || 0x12345678); }
      let h=2166136261>>>0; for(let i=0;i<seedStr.length;i++){ h^=seedStr.charCodeAt(i); h=Math.imul(h,16777619)>>>0; }
      return mulberry32(h||0x12345678);
    }

    // ---- Skor motoru (sade) ----
    function normalize(arr){
      const vals=arr.slice(1), mn=Math.min(...vals), mx=Math.max(...vals);
      const out=Array(81).fill(0);
      for(let v=1;v<=80;v++) out[v] = mx===mn ? 0.5 : (arr[v]-mn)/(mx-mn);
      return out;
    }
    function invertNormalize(gaps){
      const out=Array(81).fill(0);
      const finite=gaps.slice(1).filter(x=>isFinite(x));
      const mn=finite.length?Math.min(...finite):0;
      const mx=finite.length?Math.max(...finite):1;
      for(let v=1;v<=80;v++){
        const g=gaps[v];
        out[v]=!isFinite(g)?0.5:(mx===mn?0.5:(g-mn)/(mx-mn));
      }
      return out;
    }
    function computeScores(){
      const stats=computeStats();
      const boost=bocpdTrendBoost(400,40);
      const nW=normalize(stats.wcounts);
      const nGap=invertNormalize(stats.lastSeen);
      const score=Array(81).fill(0);
      for(let v=1;v<=80;v++){
        score[v]=0.65*nW[v] + 0.25*nGap[v] + 0.10*(0.5+boost[v]);
      }
      return {score, stats};
    }

    // ---- Ansambl (dropout) ile 20'li ---
    function ensembleTop20(baseScore, B=64, noise=0.10){
      const counts=Array(81).fill(0);
      const r=rng();
      for(let b=0;b<B;b++){
        const tmp=[];
        for(let v=1;v<=80;v++){
          const eps=(r()*2-1)*noise;
          tmp.push({v, s: baseScore[v]*(1+eps)});
        }
        tmp.sort((a,b)=>b.s-a.s || a.v-b.v);
        for(let i=0;i<20;i++) counts[tmp[i].v]++;
      }
      const arr=[];
      for(let v=1;v<=80;v++) arr.push({v, c:counts[v], s:baseScore[v]});
      arr.sort((a,b)=>b.c-a.c || b.s-a.s || a.v-b.v);
      return arr.slice(0,20).map(x=>x.v);
    }

    // ---- Çeşitlilik odaklı kupon üretici ----
    function makeTickets(pool, k, m=5){
      const r=rng();
      const useCount=new Map(pool.map(v=>[v,0]));
      const tickets=[];
      const alpha=0.9, beta=0.35, gamma=0.25;
      const globalPicked=new Set();
      for(let t=0;t<m;t++){
        const picked=[];
        for(let j=0;j<k;j++){
          let bestV=null, bestScore=-1e9;
          for(const v of pool){
            if(picked.includes(v)) continue;
            const near = picked.some(p=>Math.abs(p-v)<=1) ? 1 : 0;
            const base = 1.0 - (useCount.get(v)||0)*beta - (globalPicked.has(v)?gamma:0) - near*alpha;
            const jitter = (r()*0.06 - 0.03);
            const s = base + jitter;
            if(s>bestScore){ bestScore=s; bestV=v; }
          }
          if(bestV==null) break;
          picked.push(bestV);
          useCount.set(bestV,(useCount.get(bestV)||0)+1);
          globalPicked.add(bestV);
        }
        picked.sort((a,b)=>a-b);
        tickets.push(picked);
      }
      return tickets;
    }

    // ==== UI yardımcıları ====
    function chipHTML(n, heat){ const icon = heat==='hot'?'🔥':(heat==='cold'?'❄️':'•'); return `<span class="chip"><span class="icon">${icon}</span>${String(n).padStart(2,'0')}</span>`; }

    // ---- Tahmin + kupon + ısı panosu render ----
    let LAST_SCORES = null; // çark için
    let TOP20 = [];

    function renderAll(){
      refreshCount();
      if(state.draws.length===0){
        el('pred20').innerHTML='<span class="note">Önce veri ekleyin.</span>';
        el('t2').innerHTML=''; el('t3').innerHTML=''; el('t4').innerHTML='';
        el('heat80').innerHTML='';
        drawWheel([],[]); el('wheelLegend').innerHTML='';
        el('spinResult').textContent='—';
        return;
      }
      const {score} = computeScores();
      LAST_SCORES = score.slice();
      const top20 = ensembleTop20(score, 64, 0.10);
      TOP20 = top20.slice();

      // eşikler (top20 içi gösterim)
      const svals = top20.map(v=>score[v]).sort((a,b)=>a-b);
      const qLow = svals[Math.floor(0.30*svals.length)];
      const qHigh= svals[Math.floor(0.70*svals.length)];

      el('pred20').innerHTML = top20.map(v=>{
        const cls = score[v]>=qHigh ? 'hot' : (score[v]<=qLow ? 'cold' : 'mid');
        return chipHTML(v, cls);
      }).join('');

      // Kupon havuzu: top 34
      const pool = [...Array(81).keys()].slice(1).sort((a,b)=>score[b]-score[a] || a-b).slice(0,34);
      const T2 = makeTickets(pool, 2, 5);
      const T3 = makeTickets(pool, 3, 5);
      const T4 = makeTickets(pool, 4, 5);
      const fmt = arrs => arrs.map(a=>`<span class="chip">${a.map(x=>String(x).padStart(2,'0')).join(' ')}</span>`).join('');
      el('t2').innerHTML = fmt(T2);
      el('t3').innerHTML = fmt(T3);
      el('t4').innerHTML = fmt(T4);
      el('copy2').onclick=()=>copyTickets('2li',T2);
      el('copy3').onclick=()=>copyTickets('3lu',T3);
      el('copy4').onclick=()=>copyTickets('4lu',T4);

      // Isı panosu — tüm 80:
      renderHeat80(score);

      // Çarkı hazırla:
      setupWheel(top20, score);
    }

    function copyTickets(label, arrs){
      const text=[label+':', ...arrs.map(a=>a.join(' '))].join('\n');
      navigator.clipboard.writeText(text);
    }

    function renderHeat80(score){
      // üst %20: hot (16 sayı), alt %20: cold (16), kalan: nötr
      const idx=[...Array(80).keys()].map(i=>i+1).sort((a,b)=>score[b]-score[a] || a-b);
      const hotSet=new Set(idx.slice(0,16));
      const coldSet=new Set(idx.slice(64));
      const box=el('heat80'); box.innerHTML='';
      for(let v=1;v<=80;v++){
        const heat = hotSet.has(v)?'hot' : coldSet.has(v)?'cold' : 'mid';
        const icon = heat==='hot'?'🔥':(heat==='cold'?'❄️':'•');
        const d=document.createElement('div'); d.className='cell '+heat;
        d.innerHTML = `<span class="icon">${icon}</span><span class="n">${String(v).padStart(2,'0')}</span>`;
        box.appendChild(d);
      }
    }

    // ==== AI Şans Çarkı ====
    const wheelCanvas = ()=>document.getElementById('wheel');
    let WHEEL = { items:[], weights:[], rotation:0, spinning:false, target:0 };

    function setupWheel(top20, score){
      const items = top20.slice(); // 20 dilim
      const weights = items.map(v=> Math.max(0.0001, score[v]));
      const smin=Math.min(...weights), smax=Math.max(...weights);
      // yumuşaklaştır: exp ölçek
      const scaled = weights.map(w=>Math.exp(2 * ((w - smin)/(smax - smin + 1e-9))));
      const total = sum(scaled);
      const probs = scaled.map(x=>x/total);
      WHEEL = { items, weights: probs, rotation: WHEEL.rotation||0, spinning:false, target:0 };
      // legenda
      el('wheelLegend').innerHTML = items.map((v,i)=>{
        const heat = probs[i] >= (1/20) ? 'hot':'mid';
        return chipHTML(v, heat);
      }).join('');
      drawWheel(items, probs, WHEEL.rotation);
    }

    function drawWheel(items, probs, rotation=0){
      const cv = wheelCanvas(); const ctx = cv.getContext('2d');
      const W=cv.width, H=cv.height, cx=W/2, cy=H/2, R= Math.min(W,H)/2 - 6;
      ctx.clearRect(0,0,W,H);

      if(!items || items.length===0){
        // boş teker
        ctx.fillStyle='#0e1534'; ctx.beginPath(); ctx.arc(cx,cy,R,0,Math.PI*2); ctx.fill();
        return;
      }
      const n=items.length;
      const step = (Math.PI*2)/n;
      ctx.save();
      ctx.translate(cx,cy);
      ctx.rotate(rotation);

      for(let i=0;i<n;i++){
        const a0 = i*step, a1=(i+1)*step;
        // dilim rengi (hafif varyasyon)
        const p = probs[i]; // [~0.03 .. ~0.1]
        const tint = Math.min(1, Math.max(0, (p - (1/n)) * 12 + 0.5)); // ~0..1
        const col = `hsl(${Math.floor(210 - 80*tint)}deg 60% ${Math.floor(28 + 22*tint)}%)`;
        ctx.beginPath(); ctx.moveTo(0,0); ctx.arc(0,0,R,a0,a1); ctx.closePath();
        ctx.fillStyle=col; ctx.fill();
        ctx.strokeStyle='#1d2858'; ctx.lineWidth=1; ctx.stroke();

        // Her dilimin dışına numara
        ctx.save();
        const mid=a0+(step/2);
        ctx.rotate(mid);
        ctx.translate(R-26,0);
        ctx.rotate(Math.PI/2);
        ctx.fillStyle='#eaf2ff';
        ctx.font='12px system-ui';
        const txt=String(items[i]).padStart(2,'0');
        ctx.textAlign='center'; ctx.textBaseline='middle';
        ctx.fillText(txt,0,0);
        ctx.restore();
      }
      // merkez kapak
      ctx.beginPath(); ctx.arc(0,0,34,0,Math.PI*2);
      ctx.fillStyle='#0b1022'; ctx.fill();
      ctx.strokeStyle='#2c355f'; ctx.lineWidth=2; ctx.stroke();

      ctx.restore();
    }

    function weightedPick(weights){
      let acc=0; const r=Math.random();
      for(let i=0;i<weights.length;i++){ acc+=weights[i]; if(r<=acc) return i; }
      return weights.length-1;
    }

    function spin(strong=true){
      if(WHEEL.spinning || !WHEEL.items.length) return;
      const cv=wheelCanvas();
      const ctx=cv.getContext('2d');
      const n=WHEEL.items.length, step = (Math.PI*2)/n;

      // Hedef dilim: ağırlıklı seçim
      const idx = weightedPick(WHEEL.weights);
      const turns = strong ? 6 + Math.random()*2 : 3 + Math.random()*1.2; // tur sayısı
      // ok tepedeyken hedef dilimin merkezine denk gelsin:
      const targetAngle = (Math.PI*1.5) - (idx*step + step/2);
      const toAngle = turns*2*Math.PI + (targetAngle - (WHEEL.rotation % (2*Math.PI)));
      const dur = strong ? 2600 : 1800;

      const t0=performance.now();
      WHEEL.spinning=true;
      const startRot=WHEEL.rotation;

      function easeOutCubic(t){ return 1 - Math.pow(1-t,3); }

      function anim(t){
        const p = Math.min(1, (t - t0)/dur);
        const eased = easeOutCubic(p);
        const rot = startRot + toAngle*eased;
        WHEEL.rotation = rot;
        drawWheel(WHEEL.items, WHEEL.weights, WHEEL.rotation);
        if(p<1){ requestAnimationFrame(anim); }
        else{
          WHEEL.spinning=false;
          // Sonuç:
          const num = WHEEL.items[idx];
          el('spinResult').textContent = `Sonuç: ${String(num).padStart(2,'0')}`;
          cv.classList.remove('winflash'); void cv.offsetWidth; cv.classList.add('winflash');
        }
      }
      requestAnimationFrame(anim);
    }

    // ==== Eventler ====
    el('btnQuickAdd').addEventListener('click',()=>{
      const line=el('quickLine').value.trim();
      const d=parseLineToDraw(line);
      if(!d) return alert('20 sayı bekleniyor.');
      if(addDraw(d.nums)){ el('quickLine').value=''; renderAll(); } else { alert('Bu çekiliş zaten ekli.'); }
    });

    el('btnLoadUserData').addEventListener('click',()=>{
      const arrs = parseUserBlockToDraws(FULL_USER_DATA);
      let added=0;
      const seen=new Set(state.draws.map(d=>d.nums.join(',')));
      for(const a of arrs){
        const sig=a.join(',');
        if(seen.has(sig)) continue;
        state.draws.push({id:crypto.randomUUID(), t:Date.now(), nums:a});
        seen.add(sig); added++;
      }
      save(); renderAll();
      alert(added+' çekiliş eklendi (tekrarlar atlandı).');
    });

    el('btnClear').addEventListener('click',()=>{
      if(confirm('Tüm veriyi sil?')){ state.draws=[]; save(); renderAll(); }
    });

    el('btnReroll').addEventListener('click',()=>{
      ENGINE_SEED = (ENGINE_SEED + Math.floor(Math.random()*9999) + 1)>>>0;
      renderAll();
    });

    el('btnSpin').addEventListener('click',()=>spin(true));
    el('btnSpinSoft').addEventListener('click',()=>spin(false));

    // SW
    if('serviceWorker' in navigator){
      window.addEventListener('load',()=>{ navigator.serviceWorker.register('./sw.js',{scope:'./'}).catch(()=>{}); });
    }

    // İlk çizim
    refreshCount();
    renderAll();
  </script>
</body>
</html>
